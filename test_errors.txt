
> justice-companion@1.0.0 test:run
> vitest run


[1m[46m RUN [49m[22m [36mv4.0.14 [39m[90mC:/Users/sava6/ClaudeHome/projects/Justice Companion[39m

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mgrantConsent()[2m > [22m[2mshould grant consent for data_processing
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mgrantConsent()[2m > [22m[2mshould grant consent for all consent types
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mgrantConsent()[2m > [22m[2mshould log consent granted event
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mgrantConsent()[2m > [22m[2mshould set granted_at timestamp
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mrevokeConsent()[2m > [22m[2mshould revoke active consent
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mrevokeConsent()[2m > [22m[2mshould log consent revoked event
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mrevokeConsent()[2m > [22m[2mshould handle revoking non-existent consent gracefully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mgetProfile()[2m > [22m[2mshould get default profile after initialization
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mrevokeConsent()[2m > [22m[2mshould set revoked_at timestamp
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mcreateConversation()[2m > [22m[2mshould create conversation with case ID
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mgetProfile()[2m > [22m[2mshould decrypt encrypted name and email fields
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mhasConsent()[2m > [22m[2mshould return true for granted consent
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mcreateConversation()[2m > [22m[2mshould create conversation without case ID (global chat)
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mgetProfile()[2m > [22m[2mshould log PII access when reading encrypted fields
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mhasConsent()[2m > [22m[2mshould return false for non-existent consent
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mcreateConversation()[2m > [22m[2mshould set timestamps on creation
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mgetProfile()[2m > [22m[2mshould have timestamps set
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mhasConsent()[2m > [22m[2mshould return false for revoked consent
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mgetConversation()[2m > [22m[2mshould get conversation by ID
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mupdateProfile()[2m > [22m[2mshould update name successfully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mhasConsent()[2m > [22m[2mshould distinguish between different users
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mgetConversation()[2m > [22m[2mshould return null for non-existent conversation
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mupdateProfile()[2m > [22m[2mshould update email successfully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mgetUserConsents()[2m > [22m[2mshould return all consents for user
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mgetAllConversations()[2m > [22m[2mshould get all conversations when no case ID provided
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mupdateProfile()[2m > [22m[2mshould update avatar URL successfully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mgetUserConsents()[2m > [22m[2mshould return empty array for user with no consents
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mupdateProfile()[2m > [22m[2mshould update multiple fields at once
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mgetAllConversations()[2m > [22m[2mshould filter conversations by case ID
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mgetUserConsents()[2m > [22m[2mshould include both active and revoked consents
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mgetAllConversations()[2m > [22m[2mshould get only global conversations when case ID is null
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mupdateProfile()[2m > [22m[2mshould encrypt name before storing
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mhasRequiredConsents()[2m > [22m[2mshould return true when data_processing consent is granted
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mgetAllConversations()[2m > [22m[2mshould return empty array when no conversations exist for case
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mhasRequiredConsents()[2m > [22m[2mshould return false when data_processing consent is not granted
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mupdateProfile()[2m > [22m[2mshould encrypt email before storing
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mgetRecentConversationsByCase()[2m > [22m[2mshould get recent conversations with default limit
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mhasRequiredConsents()[2m > [22m[2mshould return false when data_processing consent is revoked
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mupdateProfile()[2m > [22m[2mshould log profile update event
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mgetRecentConversationsByCase()[2m > [22m[2mshould respect custom limit
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mgrantAllConsents()[2m > [22m[2mshould grant all four consent types
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mupdateProfile()[2m > [22m[2mshould update updated_at timestamp
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mgetRecentConversationsByCase()[2m > [22m[2mshould return conversations for global chats (null case ID)
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mgrantAllConsents()[2m > [22m[2mshould not duplicate consents if already granted
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mloadConversation()[2m > [22m[2mshould load conversation with all messages
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mupdateProfile()[2m > [22m[2mshould allow clearing email to null
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mgrantAllConsents()[2m > [22m[2mshould create exactly 4 consents
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mInput Validation[2m > [22m[2mshould reject empty name
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mloadConversation()[2m > [22m[2mshould return null for non-existent conversation
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mgrantAllConsents()[2m > [22m[2mshould log granted event for each consent type
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mloadConversation()[2m > [22m[2mshould decrypt message content when loading
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mInput Validation[2m > [22m[2mshould reject whitespace-only name
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mrevokeAllConsents()[2m > [22m[2mshould revoke all active consents
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mloadConversation()[2m > [22m[2mshould log PII access when loading messages
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mInput Validation[2m > [22m[2mshould reject invalid email format
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mrevokeAllConsents()[2m > [22m[2mshould log revoke all event
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2maddMessage()[2m > [22m[2mshould add user message successfully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mInput Validation[2m > [22m[2mshould reject email without @ symbol
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mrevokeAllConsents()[2m > [22m[2mshould handle revoking when no consents exist
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mInput Validation[2m > [22m[2mshould reject email without domain
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2maddMessage()[2m > [22m[2mshould add assistant message with thinking content
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mrevokeAllConsents()[2m > [22m[2mshould set revoked_at for all consents
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mInput Validation[2m > [22m[2mshould reject email without TLD
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2maddMessage()[2m > [22m[2mshould encrypt message content before storage
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mPrivacy Policy Version[2m > [22m[2mshould track privacy policy version on consent
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mInput Validation[2m > [22m[2mshould accept valid email formats
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2maddMessage()[2m > [22m[2mshould log message creation event
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mPrivacy Policy Version[2m > [22m[2mshould include version in audit log
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2maddMessage()[2m > [22m[2mshould set timestamp on message
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mGDPR Compliance[2m > [22m[2mshould support Article 7.3 - Right to withdraw consent
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mInput Validation[2m > [22m[2mshould allow null email explicitly
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mdeleteConversation()[2m > [22m[2mshould delete conversation and all its messages
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mGDPR Compliance[2m > [22m[2mshould maintain audit trail of consent changes
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mError Handling[2m > [22m[2mshould throw error on validation failure
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mdeleteConversation()[2m > [22m[2mshould handle deleting non-existent conversation gracefully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle multiple grant/revoke cycles
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mError Handling[2m > [22m[2mshould preserve profile data on failed update
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mstartNewConversation()[2m > [22m[2mshould create conversation with first user message
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mstartNewConversation()[2m > [22m[2mshould auto-generate title from first message (truncate at 50 chars)
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mstartNewConversation()[2m > [22m[2mshould not truncate short messages
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle concurrent users granting same consent type
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ConsentService.test.ts[2m > [22m[2mConsentService[2m > [22m[2mEdge Cases[2m > [22m[2mshould work without audit logger
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty update object gracefully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle multiple sequential updates
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long names
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/services/ConsentService.test.ts [2m([22m[2m33 tests[22m[2m)[22m[33m 1069[2mms[22m[39m
[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mstartNewConversation()[2m > [22m[2mshould support assistant as first message
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mstartNewConversation()[2m > [22m[2mshould include thinking content if provided
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle special characters in name
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle Unicode characters in name
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mError Handling[2m > [22m[2mshould throw error when creating conversation with invalid case ID
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mGDPR Compliance[2m > [22m[2mshould encrypt PII fields (name and email) at rest
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/UserProfileService.test.ts[2m > [22m[2mUserProfileService[2m > [22m[2mGDPR Compliance[2m > [22m[2mshould maintain audit trail of profile changes
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/ChatConversationService.test.ts[2m > [22m[2mChatConversationService[2m > [22m[2mError Handling[2m > [22m[2mshould throw error when adding message to non-existent conversation
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/services/UserProfileService.test.ts [2m([22m[2m30 tests[22m[2m)[22m[33m 918[2mms[22m[39m
 [32mâœ“[39m src/services/ChatConversationService.test.ts [2m([22m[2m30 tests[22m[2m)[22m[33m 908[2mms[22m[39m
[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mAuthentication[2m > [22m[2mshould register a new user
[22m[39m[API] POST http://localhost:8000/auth/register

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mAuthentication[2m > [22m[2mshould register a new user
[22m[39m[API] Response status: 201, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mAuthentication[2m > [22m[2mshould login a user
[22m[39m[API] POST http://localhost:8000/auth/login

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mAuthentication[2m > [22m[2mshould login a user
[22m[39m[API] Response status: 200, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mAuthentication[2m > [22m[2mshould logout a user
[22m[39m[API] POST http://localhost:8000/auth/logout

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mAuthentication[2m > [22m[2mshould logout a user
[22m[39m[API] Response status: 200, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mAuthentication[2m > [22m[2mshould handle login error
[22m[39m[API] POST http://localhost:8000/auth/login

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mAuthentication[2m > [22m[2mshould handle login error
[22m[39m[API] Response status: 401, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mAuthentication[2m > [22m[2mshould change password and clear session
[22m[39m[API] POST http://localhost:8000/auth/change-password

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mAuthentication[2m > [22m[2mshould change password and clear session
[22m[39m[API] Response status: 200, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mCase Management[2m > [22m[2mshould list cases
[22m[39m[API] GET http://localhost:8000/cases

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mCase Management[2m > [22m[2mshould list cases
[22m[39m[API] Response status: 200, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mCase Management[2m > [22m[2mshould get a single case
[22m[39m[API] GET http://localhost:8000/cases/1

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mCase Management[2m > [22m[2mshould get a single case
[22m[39m[API] Response status: 200, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mCase Management[2m > [22m[2mshould create a case
[22m[39m[API] POST http://localhost:8000/cases

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mCase Management[2m > [22m[2mshould create a case
[22m[39m[API] Response status: 201, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mCase Management[2m > [22m[2mshould update a case
[22m[39m[API] PUT http://localhost:8000/cases/1

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mCase Management[2m > [22m[2mshould update a case
[22m[39m[API] Response status: 200, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mCase Management[2m > [22m[2mshould delete a case
[22m[39m[API] DELETE http://localhost:8000/cases/1

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mCase Management[2m > [22m[2mshould delete a case
[22m[39m[API] Response status: 204, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mCase Management[2m > [22m[2mshould handle case not found error
[22m[39m[API] GET http://localhost:8000/cases/999

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mCase Management[2m > [22m[2mshould handle case not found error
[22m[39m[API] Response status: 404, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mEvidence Management[2m > [22m[2mshould list evidence for a case
[22m[39m[API] GET http://localhost:8000/cases/1/evidence

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mEvidence Management[2m > [22m[2mshould list evidence for a case
[22m[39m[API] Response status: 200, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mEvidence Management[2m > [22m[2mshould create evidence
[22m[39m[API] POST http://localhost:8000/evidence

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mEvidence Management[2m > [22m[2mshould create evidence
[22m[39m[API] Response status: 201, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mError Handling[2m > [22m[2mshould handle network errors
[22m[39m[API] GET http://localhost:8000/cases

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mError Handling[2m > [22m[2mshould handle 500 server errors with retry
[22m[39m[API] GET http://localhost:8000/cases

[90mstdout[2m | src/repositories/ChatConversationRepository.paginated.test.ts[2m > [22m[2mChatConversationRepository - Cursor Pagination
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/ChatConversationRepository.paginated.test.ts[2m > [22m[2mChatConversationRepository - Cursor Pagination[2m > [22m[2mPerformance comparison[2m > [22m[2mshould be more memory efficient than findWithMessages
[22m[39mPaginated: 10 messages
Non-paginated: 100 messages
Memory reduction: 90.0%

[90mstdout[2m | src/services/AuthenticationService.integration.test.ts[2m > [22m[2mAuthenticationService Integration - Rate Limiting[2m > [22m[2mRate Limiting on Login[2m > [22m[2mshould allow first login attempt
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.integration.test.ts[2m > [22m[2mAuthenticationService Integration - Rate Limiting[2m > [22m[2mRate Limiting on Login[2m > [22m[2mshould block login after 5 failed attempts
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mcreate[2m > [22m[2mshould create a case fact with encrypted content
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mcreate[2m > [22m[2mshould create case facts with different categories
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mcreate[2m > [22m[2mshould create case facts with different importance levels
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mregister()[2m > [22m[2mshould register a new user with valid credentials
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mcreate[2m > [22m[2mshould audit case fact creation
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mfindById[2m > [22m[2mshould find case fact by ID and decrypt content
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mregister()[2m > [22m[2mshould enforce minimum password length (12 chars)
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mfindById[2m > [22m[2mshould return null for non-existent ID
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mregister()[2m > [22m[2mshould require at least one uppercase letter
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mfindById[2m > [22m[2mshould audit content access
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mregister()[2m > [22m[2mshould require at least one lowercase letter
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mfindByCaseId[2m > [22m[2mshould find all case facts for a case ordered by importance
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mregister()[2m > [22m[2mshould require at least one number
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mfindByCaseId[2m > [22m[2mshould return empty array for case with no facts
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mregister()[2m > [22m[2mshould reject duplicate username
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mfindByCaseId[2m > [22m[2mshould audit bulk content access
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mError Handling[2m > [22m[2mshould handle 500 server errors with retry
[22m[39m[API] GET http://localhost:8000/cases

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mError Handling[2m > [22m[2mshould handle 500 server errors with retry
[22m[39m[API] Response status: 200, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mError Handling[2m > [22m[2mshould handle timeout errors
[22m[39m[API] GET http://localhost:8000/cases

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mfindByCategory[2m > [22m[2mshould find case facts by category
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/ChatConversationRepository.paginated.test.ts[2m > [22m[2mChatConversationRepository - Cursor Pagination[2m > [22m[2mPerformance comparison[2m > [22m[2mshould handle very large conversations gracefully
[22m[39mQuery with 1000 total messages completed in 8ms

[90mstdout[2m | src/services/AuthenticationService.integration.test.ts[2m > [22m[2mAuthenticationService Integration - Rate Limiting[2m > [22m[2mRate Limiting on Login[2m > [22m[2mshould provide specific lock time in error message
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mfindByCategory[2m > [22m[2mshould return empty array for category with no facts
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mregister()[2m > [22m[2mshould reject duplicate email
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mfindByCategory[2m > [22m[2mshould audit filtered content access
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/repositories/ChatConversationRepository.paginated.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 1047[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle very large conversations gracefully [33m 681[2mms[22m[39m
[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mError Handling[2m > [22m[2mshould handle rate limiting errors
[22m[39m[API] GET http://localhost:8000/cases

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mError Handling[2m > [22m[2mshould handle rate limiting errors
[22m[39m[API] Response status: 429, content-type: application/json

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mSession Management[2m > [22m[2mshould include session ID in request headers
[22m[39m[API] GET http://localhost:8000/cases

[90mstdout[2m | src/lib/apiClient.test.ts[2m > [22m[2mApiClient[2m > [22m[2mSession Management[2m > [22m[2mshould include session ID in request headers
[22m[39m[API] Response status: 200, content-type: application/json

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mfindByImportance[2m > [22m[2mshould find case facts by importance level
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/lib/apiClient.test.ts [2m([22m[2m25 tests[22m[2m)[22m[33m 1182[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle 500 server errors with retry [33m 1011[2mms[22m[39m
[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mfindByImportance[2m > [22m[2mshould return empty array for importance level with no facts
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mupdate[2m > [22m[2mshould update fact content with re-encryption
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mregister()[2m > [22m[2mshould generate unique salt for each user
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mupdate[2m > [22m[2mshould update fact category and importance
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mupdate[2m > [22m[2mshould return null for non-existent ID
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mupdate[2m > [22m[2mshould audit fact updates
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mdelete[2m > [22m[2mshould delete case fact
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/utils/error-logger.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1401[2mms[22m[39m
     [33m[2mâœ“[22m[39m should maintain max number of backups [33m 1164[2mms[22m[39m
[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mdelete[2m > [22m[2mshould return false for non-existent ID
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mdelete[2m > [22m[2mshould audit fact deletion
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mregister()[2m > [22m[2mshould log registration event
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mbackward compatibility[2m > [22m[2mshould handle legacy plaintext data
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/CaseFactsRepository.test.ts[2m > [22m[2mCaseFactsRepository[2m > [22m[2mCASCADE DELETE[2m > [22m[2mshould delete case facts when case is deleted
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/repositories/CaseFactsRepository.test.ts [2m([22m[2m24 tests[22m[2m)[22m[33m 847[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogin()[2m > [22m[2mshould login with valid credentials
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.integration.test.ts[2m > [22m[2mAuthenticationService Integration - Rate Limiting[2m > [22m[2mRate Limiting on Login[2m > [22m[2mshould clear rate limit after successful login
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogin()[2m > [22m[2mshould create session with 24-hour expiration
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogin()[2m > [22m[2mshould reject login with invalid username
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogin()[2m > [22m[2mshould reject login with invalid password
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mcreate[2m > [22m[2mshould create a user fact with encrypted content
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogin()[2m > [22m[2mshould reject login for inactive user
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mcreate[2m > [22m[2mshould create a note with encrypted content
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.integration.test.ts[2m > [22m[2mAuthenticationService Integration - Rate Limiting[2m > [22m[2mRate Limiting on Login[2m > [22m[2mshould handle case-insensitive usernames for rate limiting
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mcreate[2m > [22m[2mshould audit note creation
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mcreate[2m > [22m[2mshould create user facts with different types
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mcreate[2m > [22m[2mshould audit user fact creation
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mcreate[2m > [22m[2mshould not log plaintext content in audit logs
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogin()[2m > [22m[2mshould update last login timestamp
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mfindById[2m > [22m[2mshould find user fact by ID and decrypt content
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mfindById[2m > [22m[2mshould decrypt content when retrieving note
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mfindById[2m > [22m[2mshould audit PII access when decrypting content
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mfindById[2m > [22m[2mshould return null for non-existent ID
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mfindById[2m > [22m[2mshould audit content access when decrypting
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mfindById[2m > [22m[2mshould return null for non-existent note
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mfindByCaseId[2m > [22m[2mshould find all user facts for a case
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.integration.test.ts[2m > [22m[2mAuthenticationService Integration - Rate Limiting[2m > [22m[2mRate Limiting on Login[2m > [22m[2mshould rate limit even for non-existent users
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mfindByCaseId[2m > [22m[2mshould decrypt all notes for a case
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mfindByCaseId[2m > [22m[2mshould return empty array for case with no facts
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.integration.test.ts[2m > [22m[2mAuthenticationService Integration - Rate Limiting[2m > [22m[2mRate Limiting on Login[2m > [22m[2mshould rate limit inactive accounts
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mfindByCaseId[2m > [22m[2mshould return empty array for case with no notes
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mfindByCaseId[2m > [22m[2mshould audit bulk content access
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mupdate[2m > [22m[2mshould update note content with new encryption
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mfindByType[2m > [22m[2mshould find user facts by type
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/views/timeline/components/TimelineEmpty.test.tsx [2m([22m[2m13 tests[22m[2m)[22m[33m 1142[2mms[22m[39m
[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mupdate[2m > [22m[2mshould audit note update
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mfindByType[2m > [22m[2mshould return empty array for type with no facts
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogin()[2m > [22m[2mshould include IP address in session if provided
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.integration.test.ts[2m > [22m[2mAuthenticationService Integration - Rate Limiting[2m > [22m[2mRate Limiting Time Window[2m > [22m[2mshould unlock account after 15 minutes
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mdelete[2m > [22m[2mshould delete note and return true
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mfindByType[2m > [22m[2mshould audit filtered content access
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mdelete[2m > [22m[2mshould return false when deleting non-existent note
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mupdate[2m > [22m[2mshould update fact content with re-encryption
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mdelete[2m > [22m[2mshould audit note deletion
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mupdate[2m > [22m[2mshould update fact type
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/services/ProfileService.test.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 655[2mms[22m[39m
       [33m[2mâœ“[22m[39m should invalidate cache when profile is updated [33m 626[2mms[22m[39m
[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mbackward compatibility[2m > [22m[2mshould handle legacy plaintext notes
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mupdate[2m > [22m[2mshould update both content and type
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mbackward compatibility[2m > [22m[2mshould handle empty content
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mupdate[2m > [22m[2mshould audit update operation
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/NotesRepository.test.ts[2m > [22m[2mNotesRepository[2m > [22m[2mGDPR compliance[2m > [22m[2mshould never log decrypted content in audit logs
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogin()[2m > [22m[2mshould log successful login
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/repositories/NotesRepository.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 592[2mms[22m[39m
[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mdelete[2m > [22m[2mshould delete user fact
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mdelete[2m > [22m[2mshould return false for non-existent fact
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mdelete[2m > [22m[2mshould audit delete operation
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mbackward compatibility[2m > [22m[2mshould handle legacy plaintext data
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/UserFactsRepository.test.ts[2m > [22m[2mUserFactsRepository[2m > [22m[2mCASCADE DELETE[2m > [22m[2mshould delete user facts when case is deleted
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/repositories/UserFactsRepository.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 776[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogin()[2m > [22m[2mshould log failed login attempts
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/views/timeline/components/TimelineItem.test.tsx [2m([22m[2m25 tests[22m[2m)[22m[33m 1651[2mms[22m[39m
       [33m[2mâœ“[22m[39m should render deadline title and case title [33m 344[2mms[22m[39m
       [33m[2mâœ“[22m[39m should call onEdit when Edit button clicked [33m 322[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogin()[2m > [22m[2mshould use timing-safe password comparison
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.integration.test.ts[2m > [22m[2mAuthenticationService Integration - Rate Limiting[2m > [22m[2mRate Limiting Time Window[2m > [22m[2mshould reset attempt counter after 15 minute window
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mEncryption on Write Operations[2m > [22m[2mshould store encrypted evidence content in database
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mEncryption on Write Operations[2m > [22m[2mshould store file path without encryption
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/views/CasesView.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 1313[2mms[22m[39m
     [33m[2mâœ“[22m[39m renders an error state and allows retry [33m 421[2mms[22m[39m
[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mEncryption on Write Operations[2m > [22m[2mshould update and encrypt evidence content
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogout()[2m > [22m[2mshould delete session on logout
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mEncryption on Write Operations[2m > [22m[2mshould handle null content without encryption
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mDecryption on Read Operations[2m > [22m[2mshould decrypt evidence content on retrieval
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mDecryption on Read Operations[2m > [22m[2mshould decrypt all evidence content in findByCaseId
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mDecryption on Read Operations[2m > [22m[2mshould decrypt all evidence content in findAll
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mDecryption on Read Operations[2m > [22m[2mshould filter by evidence type and decrypt
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mBackward Compatibility[2m > [22m[2mshould handle legacy plaintext content
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogout()[2m > [22m[2mshould log logout event
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mEncryption Security Properties[2m > [22m[2mshould use unique IVs for same content encrypted multiple times
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mArticle 20: Data Portability (Export)[2m > [22m[2mshould export all user data from empty database
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mEncryption Security Properties[2m > [22m[2mshould fail decryption with wrong key
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mArticle 20: Data Portability (Export)[2m > [22m[2mshould export user data with decryption of encrypted fields
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mRound-Trip Testing[2m > [22m[2mshould successfully encrypt and decrypt unicode characters
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mArticle 20: Data Portability (Export)[2m > [22m[2mshould export all 15 tables with correct counts
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mRound-Trip Testing[2m > [22m[2mshould handle large evidence content (100KB+)
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mArticle 20: Data Portability (Export)[2m > [22m[2mshould save export to disk
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mRound-Trip Testing[2m > [22m[2mshould handle special characters in evidence
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mlogout()[2m > [22m[2mshould handle logout of non-existent session gracefully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mArticle 20: Data Portability (Export)[2m > [22m[2mshould create audit log for export
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mStatistics and Counting[2m > [22m[2mshould count evidence by case correctly
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.test.ts[2m > [22m[2mEvidenceRepository with Encryption[2m > [22m[2mStatistics and Counting[2m > [22m[2mshould count evidence by type correctly
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mArticle 17: Right to Erasure (Delete)[2m > [22m[2mshould delete all user data except audit logs and consents
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/repositories/EvidenceRepository.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 603[2mms[22m[39m
[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mArticle 17: Right to Erasure (Delete)[2m > [22m[2mshould require explicit confirmation
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mArticle 17: Right to Erasure (Delete)[2m > [22m[2mshould export before delete when requested
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/services/AuthenticationService.integration.test.ts [2m([22m[2m9 tests[22m[2m)[22m[33m 3627[2mms[22m[39m
       [33m[2mâœ“[22m[39m should block login after 5 failed attempts [33m 500[2mms[22m[39m
       [33m[2mâœ“[22m[39m should provide specific lock time in error message [33m 504[2mms[22m[39m
       [33m[2mâœ“[22m[39m should clear rate limit after successful login [33m 628[2mms[22m[39m
       [33m[2mâœ“[22m[39m should unlock account after 15 minutes [33m 655[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reset attempt counter after 15 minute window [33m 777[2mms[22m[39m
[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mArticle 17: Right to Erasure (Delete)[2m > [22m[2mshould respect foreign key constraints
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mvalidateSession()[2m > [22m[2mshould return user for valid session
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mArticle 17: Right to Erasure (Delete)[2m > [22m[2mshould create audit log for deletion
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mRate Limiting[2m > [22m[2mshould allow 5 exports per 24 hours
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mRate Limiting[2m > [22m[2mshould allow 1 deletion per 30 days
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mRate Limiting[2m > [22m[2mshould have separate rate limits for export and delete
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mvalidateSession()[2m > [22m[2mshould return null for null session ID
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mConsent Management[2m > [22m[2mshould require data_processing consent for export
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/gdpr/Gdpr.integration.test.ts[2m > [22m[2mGDPR Integration Tests[2m > [22m[2mConsent Management[2m > [22m[2mshould require data_processing consent for delete
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/services/gdpr/Gdpr.integration.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 605[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mvalidateSession()[2m > [22m[2mshould return null for non-existent session
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.paginated.test.ts[2m > [22m[2mEvidenceRepository - Cursor Pagination
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mvalidateSession()[2m > [22m[2mshould return null and delete expired session
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/services/LegalAPIService.test.ts [2m([22m[2m11 tests[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 568[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return LegalSearchResults structure [33m 442[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mchangePassword()[2m > [22m[2mshould change password successfully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/repositories/EvidenceRepository.paginated.test.ts[2m > [22m[2mEvidenceRepository - Cursor Pagination[2m > [22m[2mPerformance comparison[2m > [22m[2mshould be more memory efficient than findAll
[22m[39mPaginated: 10 items
Non-paginated: 100 items
Memory reduction: 90.0%

 [32mâœ“[39m src/repositories/EvidenceRepository.paginated.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 425[2mms[22m[39m
[90mstdout[2m | src/services/AuditLogger.test.ts[2m > [22m[2mAuditLogger
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mchangePassword()[2m > [22m[2mshould reject old password after change
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuditLogger.test.ts[2m > [22m[2mAuditLogger[2m > [22m[2mError Handling[2m > [22m[2mdoes not throw on logging failure
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/repositories/FactsRepositories.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 166[2mms[22m[39m
 [32mâœ“[39m src/services/AuditLogger.test.ts [2m([22m[2m52 tests[22m[2m)[22m[32m 264[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mchangePassword()[2m > [22m[2mshould reject change with incorrect old password
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/utils/cursor-pagination.test.ts [2m([22m[2m87 tests[22m[2m)[22m[32m 184[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mchangePassword()[2m > [22m[2mshould validate new password strength
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mchangePassword()[2m > [22m[2mshould invalidate all sessions after password change
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/services/EncryptionService.batch.test.ts [2m([22m[2m16 tests[22m[2m | [22m[33m1 skipped[39m[2m)[22m[32m 267[2mms[22m[39m
[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mmigrateFromEnv() - Migrate from .env[2m > [22m[2mshould migrate valid key from .env to safeStorage
[22m[39m[KeyManager] Key migrated from .env to safeStorage 
[KeyManager] IMPORTANT: Remove ENCRYPTION_KEY_BASE64 from .env file 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mmigrateFromEnv() - Migrate from .env[2m > [22m[2mshould set file permissions to 0o600 (read/write owner only)
[22m[39m[KeyManager] Key migrated from .env to safeStorage 
[KeyManager] IMPORTANT: Remove ENCRYPTION_KEY_BASE64 from .env file 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mgenerateNewKey() - Generate Encryption Key[2m > [22m[2mshould generate 32-byte key
[22m[39m[KeyManager] New encryption key generated and stored 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mgenerateNewKey() - Generate Encryption Key[2m > [22m[2mshould encrypt and store generated key
[22m[39m[KeyManager] New encryption key generated and stored 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mgenerateNewKey() - Generate Encryption Key[2m > [22m[2mshould cache generated key
[22m[39m[KeyManager] New encryption key generated and stored 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mgenerateNewKey() - Generate Encryption Key[2m > [22m[2mshould generate cryptographically random keys
[22m[39m[KeyManager] New encryption key generated and stored 
[KeyManager] New encryption key generated and stored 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mrotateKey() - Key Rotation[2m > [22m[2mshould backup old key before rotation
[22m[39m[KeyManager] Old key backed up to: C:\Users\sava6\AppData\Local\Temp\keymanager-test-mWezmX\.encryption-key.backup.1764263971931 
[KeyManager] New encryption key generated and stored 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mrotateKey() - Key Rotation[2m > [22m[2mshould generate new key after backup
[22m[39m[KeyManager] Old key backed up to: C:\Users\sava6\AppData\Local\Temp\keymanager-test-M0vDQM\.encryption-key.backup.1764263971939 
[KeyManager] New encryption key generated and stored 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mrotateKey() - Key Rotation[2m > [22m[2mshould handle missing old key gracefully
[22m[39m[KeyManager] New encryption key generated and stored 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mrotateKey() - Key Rotation[2m > [22m[2mshould include timestamp in backup filename
[22m[39m[KeyManager] Old key backed up to: C:\Users\sava6\AppData\Local\Temp\keymanager-test-6GeDAQ\.encryption-key.backup.1764263971950 
[KeyManager] New encryption key generated and stored 

 [32mâœ“[39m src/views/timeline/TimelineView.test.tsx [2m([22m[2m29 tests[22m[2m)[22m[33m 4733[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create new deadline via API [33m 1140[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update deadline via API [33m 737[2mms[22m[39m
       [33m[2mâœ“[22m[39m should filter deadlines by selected case [33m 431[2mms[22m[39m
[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mSecurity Properties[2m > [22m[2mshould never store key in plaintext on disk
[22m[39m[KeyManager] New encryption key generated and stored 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mSecurity Properties[2m > [22m[2mshould use OS-level encryption for all key operations
[22m[39m[KeyManager] New encryption key generated and stored 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mSecurity Properties[2m > [22m[2mshould enforce 32-byte key length consistently
[22m[39m[KeyManager] Key migrated from .env to safeStorage 
[KeyManager] IMPORTANT: Remove ENCRYPTION_KEY_BASE64 from .env file 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mSecurity Properties[2m > [22m[2mshould protect key file with restrictive permissions
[22m[39m[KeyManager] New encryption key generated and stored 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle complete migration workflow
[22m[39m[KeyManager] Key migrated from .env to safeStorage 
[KeyManager] IMPORTANT: Remove ENCRYPTION_KEY_BASE64 from .env file 

[90mstderr[2m | src/services/KeyManager.test.ts[2m > [22m[2mKeyManager - Encryption Key Security[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle key rotation workflow
[22m[39m[KeyManager] Old key backed up to: C:\Users\sava6\AppData\Local\Temp\keymanager-test-Cw6SrP\.encryption-key.backup.1764263972029 
[KeyManager] New encryption key generated and stored 

[90mstdout[2m | src/repositories/CaseRepository.test.ts[2m > [22m[2mCaseRepository with Encryption
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/services/KeyManager.test.ts [2m([22m[2m36 tests[22m[2m)[22m[32m 220[2mms[22m[39m
 [32mâœ“[39m src/repositories/CaseRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 94[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mchangePassword()[2m > [22m[2mshould log password change event
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mchangePassword()[2m > [22m[2mshould log failed password change attempts
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/utils/formatters.test.ts [2m([22m[2m38 tests[22m[2m)[22m[32m 71[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mcleanupExpiredSessions()[2m > [22m[2mshould delete expired sessions
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/components/ui/Badge.test.tsx [2m([22m[2m37 tests[22m[2m)[22m[32m 259[2mms[22m[39m
 [32mâœ“[39m src/views/settings/BackupSettings.test.tsx [2m([22m[2m25 tests[22m[2m)[22m[33m 5148[2mms[22m[39m
     [33m[2mâœ“[22m[39m renders backup settings UI [33m 402[2mms[22m[39m
     [33m[2mâœ“[22m[39m shows create backup button [33m 559[2mms[22m[39m
     [33m[2mâœ“[22m[39m renders backup list items with actions [33m 339[2mms[22m[39m
     [33m[2mâœ“[22m[39m handles save settings button [33m 473[2mms[22m[39m
     [33m[2mâœ“[22m[39m expands and collapses backup details [33m 463[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mcleanupExpiredSessions()[2m > [22m[2mshould return 0 if no expired sessions
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mcleanupExpiredSessions()[2m > [22m[2mshould log cleanup event if sessions deleted
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/repositories/Phase3Repositories.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 81[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mSecurity - Password Hashing[2m > [22m[2mshould never store passwords in plaintext
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mSecurity - Password Hashing[2m > [22m[2mshould use random salt for each user
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mSecurity - Password Hashing[2m > [22m[2mshould produce consistent hash for same password+salt
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/NotificationService.test.ts[2m > [22m[2mNotificationService[2m > [22m[2mcreateNotification[2m > [22m[2mshould throw error when notification type is disabled
[22m[39mNotification type disabled {
  service: [32m'NotificationService'[39m,
  type: [32m'deadline_reminder'[39m,
  userId: [33m1[39m
}

 [32mâœ“[39m src/services/EncryptionService.test.ts [2m([22m[2m48 tests[22m[2m)[22m[32m 53[2mms[22m[39m
[90mstdout[2m | src/services/NotificationService.test.ts[2m > [22m[2mNotificationService[2m > [22m[2mcreateNotification[2m > [22m[2mshould throw error during quiet hours
[22m[39mBlocking notification during quiet hours { service: [32m'NotificationService'[39m, userId: [33m1[39m }

[90mstderr[2m | src/services/SessionPersistenceService.browser.test.ts[2m > [22m[2mSessionPersistenceService (browser storage)[2m > [22m[2mstoreSessionId & retrieveSessionId[2m > [22m[2mrejects invalid session IDs
[22m[39mFailed to store session ID {
  service: [32m'SessionPersistence'[39m,
  error: Error: Invalid session ID format (expected UUID v4)
      at SessionPersistenceService.storeSessionId (C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.ts:115:15)
      at C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.browser.test.ts:48:30
      at [90mfile:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:145:11
      at [90mfile:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:919:26
      at [90mfile:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1244:20
      at new Promise (<anonymous>)
      at runWithTimeout [90m(file:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1210:10[90m)[39m
      at [90mfile:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:1654:37
      at Traces.$ [90m(file:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
      at trace [90m(file:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4mvitest[24m/dist/chunks/test.DqQZzsWf.js:234:21[90m)[39m
}

[90mstderr[2m | src/services/SessionPersistenceService.browser.test.ts[2m > [22m[2mSessionPersistenceService (browser storage)[2m > [22m[2mstoreSessionId & retrieveSessionId[2m > [22m[2mrejects invalid session IDs
[22m[39mFailed to store session ID {
  service: [32m'SessionPersistence'[39m,
  error: Error: Invalid session ID format (expected UUID v4)
      at SessionPersistenceService.storeSessionId (C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.ts:115:15)
      at C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.browser.test.ts:48:30
  [90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
      at [90mfile:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:919:20
}

[90mstderr[2m | src/services/SessionPersistenceService.browser.test.ts[2m > [22m[2mSessionPersistenceService (browser storage)[2m > [22m[2mstoreSessionId & retrieveSessionId[2m > [22m[2mrejects invalid session IDs
[22m[39mFailed to store session ID {
  service: [32m'SessionPersistence'[39m,
  error: Error: Invalid session ID format (expected UUID v4)
      at SessionPersistenceService.storeSessionId (C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.ts:115:15)
      at C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.browser.test.ts:48:30
  [90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
      at [90mfile:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:919:20
}

[90mstderr[2m | src/services/SessionPersistenceService.browser.test.ts[2m > [22m[2mSessionPersistenceService (browser storage)[2m > [22m[2mstoreSessionId & retrieveSessionId[2m > [22m[2mrejects invalid session IDs
[22m[39mFailed to store session ID {
  service: [32m'SessionPersistence'[39m,
  error: Error: Invalid session ID format (expected UUID v4)
      at SessionPersistenceService.storeSessionId (C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.ts:115:15)
      at C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.browser.test.ts:48:30
  [90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
      at [90mfile:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:919:20
}

[90mstderr[2m | src/services/SessionPersistenceService.browser.test.ts[2m > [22m[2mSessionPersistenceService (browser storage)[2m > [22m[2mstoreSessionId & retrieveSessionId[2m > [22m[2mrejects invalid session IDs
[22m[39mFailed to store session ID {
  service: [32m'SessionPersistence'[39m,
  error: Error: Invalid session ID format (expected UUID v4)
      at SessionPersistenceService.storeSessionId (C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.ts:115:15)
      at C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.browser.test.ts:48:30
  [90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
      at [90mfile:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:919:20
}

[90mstderr[2m | src/services/SessionPersistenceService.browser.test.ts[2m > [22m[2mSessionPersistenceService (browser storage)[2m > [22m[2mstoreSessionId & retrieveSessionId[2m > [22m[2mrejects invalid session IDs
[22m[39mFailed to store session ID {
  service: [32m'SessionPersistence'[39m,
  error: Error: Invalid session ID format (expected UUID v4)
      at SessionPersistenceService.storeSessionId (C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.ts:115:15)
      at C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.browser.test.ts:48:30
  [90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
      at [90mfile:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:919:20
}

[90mstderr[2m | src/services/SessionPersistenceService.browser.test.ts[2m > [22m[2mSessionPersistenceService (browser storage)[2m > [22m[2mstoreSessionId & retrieveSessionId[2m > [22m[2mrejects invalid session IDs
[22m[39mFailed to store session ID {
  service: [32m'SessionPersistence'[39m,
  error: Error: Invalid session ID format (expected UUID v4)
      at SessionPersistenceService.storeSessionId (C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.ts:115:15)
      at C:/Users/sava6/ClaudeHome/projects/Justice Companion/src/services/SessionPersistenceService.browser.test.ts:48:30
  [90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
      at [90mfile:///C:/Users/sava6/ClaudeHome/projects/Justice%20Companion/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:919:20
}

[90mstderr[2m | src/services/SessionPersistenceService.browser.test.ts[2m > [22m[2mSessionPersistenceService (browser storage)[2m > [22m[2mstoreSessionId & retrieveSessionId[2m > [22m[2mreturns null and clears storage for invalid stored value
[22m[39mSessionPersistence {
  [32m'0'[39m: [32m'S'[39m,
  [32m'1'[39m: [32m't'[39m,
  [32m'2'[39m: [32m'o'[39m,
  [32m'3'[39m: [32m'r'[39m,
  [32m'4'[39m: [32m'e'[39m,
  [32m'5'[39m: [32m'd'[39m,
  [32m'6'[39m: [32m' '[39m,
  [32m'7'[39m: [32m's'[39m,
  [32m'8'[39m: [32m'e'[39m,
  [32m'9'[39m: [32m's'[39m,
  [32m'10'[39m: [32m's'[39m,
  [32m'11'[39m: [32m'i'[39m,
  [32m'12'[39m: [32m'o'[39m,
  [32m'13'[39m: [32m'n'[39m,
  [32m'14'[39m: [32m' '[39m,
  [32m'15'[39m: [32m'I'[39m,
  [32m'16'[39m: [32m'D'[39m,
  [32m'17'[39m: [32m' '[39m,
  [32m'18'[39m: [32m'i'[39m,
  [32m'19'[39m: [32m's'[39m,
  [32m'20'[39m: [32m' '[39m,
  [32m'21'[39m: [32m'i'[39m,
  [32m'22'[39m: [32m'n'[39m,
  [32m'23'[39m: [32m'v'[39m,
  [32m'24'[39m: [32m'a'[39m,
  [32m'25'[39m: [32m'l'[39m,
  [32m'26'[39m: [32m'i'[39m,
  [32m'27'[39m: [32m'd'[39m
}

 [32mâœ“[39m src/services/SessionPersistenceService.browser.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 44[2mms[22m[39m
 [32mâœ“[39m src/services/NotificationService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 53[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mSecurity - Session Management[2m > [22m[2mshould generate UUID session IDs
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/middleware/AuthorizationMiddleware.test.ts [2m([22m[2m39 tests[22m[2m)[22m[32m 46[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mSecurity - Session Management[2m > [22m[2mshould generate unique session IDs
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/services/export/ExportService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 51[2mms[22m[39m
[90mstdout[2m | src/repositories.test.ts[2m > [22m[2mRepository System[2m > [22m[2mgetRepositories[2m > [22m[2mshould return a repository container with all required repositories
[22m[39m[Repositories] Initializing with encryption key from: .env file { service: [32m'Repositories'[39m }
[Repositories] Key (first 10 chars): AQEBAQEBAQ { service: [32m'Repositories'[39m }

[90mstdout[2m | src/repositories.test.ts[2m > [22m[2mRepository System[2m > [22m[2mgetRepositories[2m > [22m[2mshould return the same instance on multiple calls (singleton)
[22m[39m[Repositories] Initializing with encryption key from: .env file { service: [32m'Repositories'[39m }
[Repositories] Key (first 10 chars): AQEBAQEBAQ { service: [32m'Repositories'[39m }

[90mstdout[2m | src/repositories.test.ts[2m > [22m[2mRepository System[2m > [22m[2mgetRepositories[2m > [22m[2mshould create new instances after reset
[22m[39m[Repositories] Initializing with encryption key from: .env file { service: [32m'Repositories'[39m }
[Repositories] Key (first 10 chars): AQEBAQEBAQ { service: [32m'Repositories'[39m }
[Repositories] Initializing with encryption key from: .env file { service: [32m'Repositories'[39m }
[Repositories] Key (first 10 chars): AQEBAQEBAQ { service: [32m'Repositories'[39m }

[90mstdout[2m | src/repositories.test.ts[2m > [22m[2mRepository System[2m > [22m[2mresetRepositories[2m > [22m[2mshould reset the repository container to null
[22m[39m[Repositories] Initializing with encryption key from: .env file { service: [32m'Repositories'[39m }
[Repositories] Key (first 10 chars): AQEBAQEBAQ { service: [32m'Repositories'[39m }
[Repositories] Initializing with encryption key from: .env file { service: [32m'Repositories'[39m }
[Repositories] Key (first 10 chars): AQEBAQEBAQ { service: [32m'Repositories'[39m }

 [32mâœ“[39m src/repositories.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 38[2mms[22m[39m
[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mRate Limiting[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mBRUTE FORCE DETECTED for testuser. Account locked for 900s 
Rate limit exceeded for testuser. Attempts: 5, Lock time remaining: 900s 

[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mSliding Window[2m > [22m[2mshould unlock account after lock duration expires
[22m[39mBRUTE FORCE DETECTED for testuser. Account locked for 900s 
Rate limit exceeded for testuser. Attempts: 5, Lock time remaining: 900s 

[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mCleanup Mechanism[2m > [22m[2mshould not clean up locked accounts prematurely
[22m[39mBRUTE FORCE DETECTED for lockeduser. Account locked for 900s 

[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mHelper Methods[2m > [22m[2mshould correctly check if account is locked
[22m[39mBRUTE FORCE DETECTED for testuser. Account locked for 900s 

[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mHelper Methods[2m > [22m[2mshould provide accurate statistics
[22m[39mBRUTE FORCE DETECTED for lockeduser. Account locked for 900s 

[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle rapid successive attempts
[22m[39mBRUTE FORCE DETECTED for testuser. Account locked for 900s 

[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mEdge Cases[2m > [22m[2mshould not increment count when already locked
[22m[39mBRUTE FORCE DETECTED for testuser. Account locked for 900s 

 [32mâœ“[39m src/services/RateLimitService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 38[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mSecurity - Session Management[2m > [22m[2mshould enforce 24-hour session expiration
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/services/SearchService.test.ts [2m([22m[2m9 tests[22m[2m | [22m[33m1 skipped[39m[2m)[22m[32m 26[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mshould create session with Remember Me flag
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstderr[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mshould create session with Remember Me flag
[22m[39mRemember Me requested but no persistence handler configured { service: [32m'AuthenticationService'[39m }

 [32mâœ“[39m src/types/pagination.test.ts [2m([22m[2m26 tests[22m[2m)[22m[32m 19[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mshould create 30-day session when Remember Me is enabled
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/errors/DomainErrors.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 17[2mms[22m[39m
[90mstderr[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mshould create 30-day session when Remember Me is enabled
[22m[39mRemember Me requested but no persistence handler configured { service: [32m'AuthenticationService'[39m }

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mshould handle Remember Me without persistence handler gracefully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/services/SessionPersistenceService.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 21[2mms[22m[39m
 [32mâœ“[39m src/utils/passwordValidation.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 10[2mms[22m[39m
[90mstderr[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mshould handle Remember Me without persistence handler gracefully
[22m[39mRemember Me requested but no persistence handler configured { service: [32m'AuthenticationService'[39m }

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mshould always generate new session ID on login (prevent session fixation)
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mshould restore persisted session returns null without handler
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mwith mock persistence handler[2m > [22m[2mshould store session when Remember Me is enabled
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mwith mock persistence handler[2m > [22m[2mshould not store session when Remember Me is disabled
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mwith mock persistence handler[2m > [22m[2mshould clear persisted session on logout
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mwith mock persistence handler[2m > [22m[2mshould restore valid persisted session
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mRemember Me and Session Persistence[2m > [22m[2mwith mock persistence handler[2m > [22m[2mshould clear expired persisted session
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty username gracefully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/views/timeline/components/AddDeadlineDialog.test.tsx [2m([22m[2m25 tests[22m[2m)[22m[33m 8060[2mms[22m[39m
       [33m[2mâœ“[22m[39m should require case selection [33m 790[2mms[22m[39m
       [33m[2mâœ“[22m[39m should require deadline date [33m 596[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not allow past dates [33m 1135[2mms[22m[39m
       [33m[2mâœ“[22m[39m should submit valid form data [33m 1782[2mms[22m[39m
       [33m[2mâœ“[22m[39m should close dialog after successful submission [33m 819[2mms[22m[39m
       [33m[2mâœ“[22m[39m should show error message on submission failure [33m 651[2mms[22m[39m
       [33m[2mâœ“[22m[39m should disable submit button while submitting [33m 557[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reset form when reopened after cancel [33m 540[2mms[22m[39m
[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty password gracefully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty email gracefully
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long passwords
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

[90mstdout[2m | src/services/AuthenticationService.test.ts[2m > [22m[2mAuthenticationService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle special characters in password
[22m[39m[TestDatabaseHelper] Initializing in-memory database...
[TestDatabaseHelper] Encryption service initialized with test key
[TestDatabaseHelper] Finding migrations directory...
[TestDatabaseHelper] process.cwd(): C:\Users\sava6\ClaudeHome\projects\Justice Companion
[TestDatabaseHelper] __dirname: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\test-utils
[TestDatabaseHelper] Checking path: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] âœ… Found migrations at: C:\Users\sava6\ClaudeHome\projects\Justice Companion\src\db\migrations
[TestDatabaseHelper] Running 19 migrations...
[TestDatabaseHelper] Applying migration: 001_initial_schema.sql
[TestDatabaseHelper] Applying migration: 002_chat_history_and_profile.sql
[TestDatabaseHelper] Applying migration: 003_audit_logs.sql
[TestDatabaseHelper] Applying migration: 004_encryption_expansion.sql
[TestDatabaseHelper] Applying migration: 005_user_and_case_facts.sql
[TestDatabaseHelper] Applying migration: 010_authentication_system.sql
[TestDatabaseHelper] Applying migration: 011_add_user_ownership.sql
[TestDatabaseHelper] Applying migration: 012_consent_management.sql
[TestDatabaseHelper] Applying migration: 013_add_remember_me_to_sessions.sql
[TestDatabaseHelper] Applying migration: 014_remove_unused_remember_me_index.sql
[TestDatabaseHelper] Applying migration: 015_add_performance_indexes.sql
[TestDatabaseHelper] Applying migration: 016_create_deadlines_table.sql
[TestDatabaseHelper] Applying migration: 017_create_search_tables.sql
[TestDatabaseHelper] Applying migration: 018_create_notifications_table.sql
[TestDatabaseHelper] Applying migration: 020_create_templates_system.sql
[TestDatabaseHelper] Applying migration: 021_create_events_table.sql
[TestDatabaseHelper] Applying migration: 022_add_backup_settings.sql
[TestDatabaseHelper] Applying migration: 023_create_deadline_dependencies.sql
[TestDatabaseHelper] Applying migration: 024_add_evidence_updated_at.sql
[TestDatabaseHelper] All migrations applied successfully.

 [32mâœ“[39m src/services/AuthenticationService.test.ts [2m([22m[2m57 tests[22m[2m)[22m[33m 9057[2mms[22m[39m
       [33m[2mâœ“[22m[39m should change password successfully [33m 356[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject old password after change [33m 332[2mms[22m[39m
       [33m[2mâœ“[22m[39m should invalidate all sessions after password change [33m 398[2mms[22m[39m
       [33m[2mâœ“[22m[39m should delete expired sessions [33m 324[2mms[22m[39m

[2m Test Files [22m [1m[32m43 passed[39m[22m[90m (43)[39m
[2m      Tests [22m [1m[32m983 passed[39m[22m[2m | [22m[33m3 skipped[39m[90m (986)[39m
[2m   Start at [22m 17:19:21
[2m   Duration [22m 13.64s[2m (transform 10.18s, setup 12.74s, import 21.99s, tests 48.35s, environment 71.85s)[22m

