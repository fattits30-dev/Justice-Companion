
> justice-companion@1.0.0 test F:\Justice Companion take 2
> vitest "--run"

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

[1m[7m[36m RUN [39m[27m[22m [36mv2.1.9 [39m[90mF:/Justice Companion take 2[39m

 [32m✓[39m src/electron-ipc-authorization.test.ts [2m([22m[2m30 tests[22m[2m)[22m[90m 33[2mms[22m[39m
 [31m❯[39m src/features/facts/hooks/useCaseFacts.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/features/facts/hooks/useUserFacts.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/features/timeline/hooks/useTimeline.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/features/facts/components/CaseFactsPanel.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/features/notes/components/NotesPanel.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/services/AuthenticationService.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/features/settings/components/SettingsView.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [32m✓[39m src/features/facts/services/CaseFactsService.test.ts [2m([22m[2m32 tests[22m[2m)[22m[90m 57[2mms[22m[39m
 [32m✓[39m src/services/SecureStorageService.test.ts [2m([22m[2m75 tests[22m[2m)[22m[90m 173[2mms[22m[39m
 [32m✓[39m src/electron-ipc-handlers.test.ts [2m([22m[2m90 tests[22m[2m)[22m[90m 143[2mms[22m[39m
 [31m❯[39m src/services/AuditLogger.test.ts [2m([22m[2m52 tests[22m[2m | [22m[31m21 failed[39m[2m)[22m[90m 163[2mms[22m[39m
[31m   [31m×[31m AuditLogger[2m > [22mError Handling[2m > [22mdoes not throw on logging failure[90m 14[2mms[22m[31m[39m
[31m     → vi is not defined[39m
[31m   [31m×[31m AuditLogger[2m > [22mEdge Cases[2m > [22mhandles null/undefined optional fields[90m 2[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mEdge Cases[2m > [22mserializes complex details objects[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mEdge Cases[2m > [22mhandles details with null value[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mEdge Cases[2m > [22mhandles empty details object[90m 0[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mEdge Cases[2m > [22mhandles very long detail strings[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mEdge Cases[2m > [22mhandles special characters in fields[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mEdge Cases[2m > [22mhandles Unicode characters in details[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mAction Types[2m > [22msupports create action[90m 3[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mAction Types[2m > [22msupports read action[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mAction Types[2m > [22msupports update action[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mAction Types[2m > [22msupports delete action[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mAction Types[2m > [22msupports export action[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mAction Types[2m > [22msupports decrypt action[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mSuccess and Error Tracking[2m > [22mlogs successful operations with success=true[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mSuccess and Error Tracking[2m > [22mlogs failed operations with success=false and error message[90m 3[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mSuccess and Error Tracking[2m > [22mfilters successful operations only[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mSuccess and Error Tracking[2m > [22mfilters failed operations only[90m 0[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mImmutability[2m > [22mcreates new log entries without modifying existing ones[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mLarge Chain Verification[2m > [22mverifies chain with 100 entries[90m 0[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
[31m   [31m×[31m AuditLogger[2m > [22mLarge Chain Verification[2m > [22mdetects tampering in middle of large chain[90m 1[2mms[22m[31m[39m
[31m     → The database connection is not open[39m
 [31m❯[39m src/features/legal/hooks/useLegalIssues.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/features/documents/components/DocumentsView.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/tests/authorization-security.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/features/notes/hooks/useNotes.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [32m✓[39m src/middleware/AuthorizationMiddleware.test.ts [2m([22m[2m39 tests[22m[2m)[22m[90m 53[2mms[22m[39m
 [32m✓[39m src/services/EncryptionService.test.ts [2m([22m[2m48 tests[22m[2m)[22m[90m 57[2mms[22m[39m
 [32m✓[39m src/features/timeline/services/TimelineService.test.ts [2m([22m[2m28 tests[22m[2m)[22m[90m 41[2mms[22m[39m
 [32m✓[39m src/features/facts/services/UserFactsService.test.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 39[2mms[22m[39m
 [32m✓[39m src/repositories/CaseFactsRepository.test.ts [2m([22m[2m24 tests[22m[2m)[22m[90m 136[2mms[22m[39m
 [32m✓[39m src/repositories/FactsRepositories.test.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 162[2mms[22m[39m
 [32m✓[39m src/services/AuditLogger.e2e.test.ts [2m([22m[2m31 tests[22m[2m)[22m[33m 1095[2mms[22m[39m
   [33m[2m✓[22m[39m AuditLogger E2E[2m > [22mPerformance Tests[2m > [22mverifies integrity of 1000+ log chain in reasonable time [33m354[2mms[22m[39m
 [31m❯[39m tests/e2e/specs/authentication.e2e.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m tests/e2e/specs/authorization.e2e.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/components/PostItNote.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/features/chat/components/MessageBubble.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/features/cases/components/CaseDetailView.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/features/facts/components/UserFactsPanel.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [32m✓[39m src/features/legal/services/LegalIssuesService.test.ts [2m([22m[2m26 tests[22m[2m)[22m[90m 52[2mms[22m[39m
 [31m❯[39m src/services/SessionPersistenceService.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [32m✓[39m src/repositories/UserFactsRepository.test.ts [2m([22m[2m21 tests[22m[2m)[22m[90m 121[2mms[22m[39m
 [31m❯[39m src/components/ErrorBoundary.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m tests/e2e/specs/remember-me.e2e.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [32m✓[39m src/services/RAGService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[90m 32[2mms[22m[39m
 [31m❯[39m src/features/cases/components/CasesView.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [32m✓[39m src/repositories/EvidenceRepository.test.ts [2m([22m[2m16 tests[22m[2m)[22m[90m 101[2mms[22m[39m
 [31m❯[39m src/features/dashboard/components/DashboardView.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/services/ChatConversationService.test.ts [2m([22m[2m30 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 678[2mms[22m[39m
[31m   [31m×[31m ChatConversationService[2m > [22mloadConversation()[2m > [22mshould log PII access when loading messages[90m 38[2mms[22m[31m[39m
[31m     → expected undefined to be defined[39m
[31m   [31m×[31m ChatConversationService[2m > [22maddMessage()[2m > [22mshould log message creation event[90m 21[2mms[22m[31m[39m
[31m     → expected undefined to be defined[39m
 [31m❯[39m src/utils/migrate-to-secure-storage.test.ts [2m([22m[2m12 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[90m 49[2mms[22m[39m
[31m   [31m×[31m migrate-to-secure-storage[2m > [22mmigrateToSecureStorage[2m > [22mshould migrate API keys from localStorage to secure storage[90m 20[2mms[22m[31m[39m
[31m     → expected +0 to be 3 // Object.is equality[39m
[31m   [31m×[31m migrate-to-secure-storage[2m > [22mmigrateToSecureStorage[2m > [22mshould not migrate keys that already exist in secure storage[90m 5[2mms[22m[31m[39m
[31m     → expected "spy" to be called with arguments: [ 'openai_api_key' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31m×[31m migrate-to-secure-storage[2m > [22mmigrateToSecureStorage[2m > [22mshould handle errors gracefully[90m 2[2mms[22m[31m[39m
[31m     → expected true to be false // Object.is equality[39m
[31m   [31m×[31m migrate-to-secure-storage[2m > [22mmigrateToSecureStorage[2m > [22mshould warn when encryption is not available[90m 4[2mms[22m[31m[39m
[31m     → expected "warn" to be called with arguments: [ StringContaining{…} ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31m×[31m migrate-to-secure-storage[2m > [22mmigrateToSecureStorage[2m > [22mshould be idempotent (safe to run multiple times)[90m 5[2mms[22m[31m[39m
[31m     → expected +0 to be 1 // Object.is equality[39m
[31m   [31m×[31m migrate-to-secure-storage[2m > [22misMigrationNeeded[2m > [22mshould return true when keys exist in localStorage but not in secure storage[90m 2[2mms[22m[31m[39m
[31m     → expected false to be true // Object.is equality[39m
[31m   [31m×[31m migrate-to-secure-storage[2m > [22mcleanupLocalStorage[2m > [22mshould remove all migration keys from localStorage[90m 1[2mms[22m[31m[39m
[31m     → expected "spy" to be called with arguments: [ 'openai_api_key' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31m×[31m migrate-to-secure-storage[2m > [22mcleanupLocalStorage[2m > [22mshould handle errors gracefully[90m 3[2mms[22m[31m[39m
[31m     → expected "error" to be called at least once[39m
 [32m✓[39m src/repositories/Phase3Repositories.test.ts [2m([22m[2m15 tests[22m[2m)[22m[90m 84[2mms[22m[39m
 [31m❯[39m src/features/chat/components/ChatInput.test.tsx [2m([22m[2m0 test[22m[2m)[22m
 [32m✓[39m src/services/ConsentService.test.ts [2m([22m[2m33 tests[22m[2m)[22m[33m 891[2mms[22m[39m
 [32m✓[39m src/repositories/CaseRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 76[2mms[22m[39m
 [32m✓[39m src/repositories/NotesRepository.test.ts [2m([22m[2m16 tests[22m[2m)[22m[90m 101[2mms[22m[39m
[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mRate Limiting[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39m[RateLimitService] BRUTE FORCE DETECTED for testuser. Account locked for 900s
[RateLimitService] Rate limit exceeded for testuser. Attempts: 5, Lock time remaining: 900s

[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mSliding Window[2m > [22m[2mshould unlock account after lock duration expires
[22m[39m[RateLimitService] BRUTE FORCE DETECTED for testuser. Account locked for 900s
[RateLimitService] Rate limit exceeded for testuser. Attempts: 5, Lock time remaining: 900s

[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mCleanup Mechanism[2m > [22m[2mshould not clean up locked accounts prematurely
[22m[39m[RateLimitService] BRUTE FORCE DETECTED for lockeduser. Account locked for 900s

[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mHelper Methods[2m > [22m[2mshould correctly check if account is locked
[22m[39m[RateLimitService] BRUTE FORCE DETECTED for testuser. Account locked for 900s

[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mHelper Methods[2m > [22m[2mshould provide accurate statistics
[22m[39m[RateLimitService] BRUTE FORCE DETECTED for lockeduser. Account locked for 900s

[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle rapid successive attempts
[22m[39m[RateLimitService] BRUTE FORCE DETECTED for testuser. Account locked for 900s

[90mstderr[2m | src/services/RateLimitService.test.ts[2m > [22m[2mRateLimitService[2m > [22m[2mEdge Cases[2m > [22m[2mshould not increment count when already locked
[22m[39m[RateLimitService] BRUTE FORCE DETECTED for testuser. Account locked for 900s

 [32m✓[39m src/services/RateLimitService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[90m 45[2mms[22m[39m
 [32m✓[39m src/features/notes/services/NotesService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[90m 35[2mms[22m[39m
 [31m❯[39m src/services/StartupMetrics.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/services/UserProfileService.test.ts [2m([22m[2m30 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 826[2mms[22m[39m
[31m   [31m×[31m UserProfileService[2m > [22mgetProfile()[2m > [22mshould log PII access when reading encrypted fields[90m 29[2mms[22m[31m[39m
[31m     → expected undefined to be defined[39m
[31m   [31m×[31m UserProfileService[2m > [22mupdateProfile()[2m > [22mshould log profile update event[90m 37[2mms[22m[31m[39m
[31m     → expected undefined to be defined[39m
[31m   [31m×[31m UserProfileService[2m > [22mGDPR Compliance[2m > [22mshould maintain audit trail of profile changes[90m 25[2mms[22m[31m[39m
[31m     → expected 0 to be greater than or equal to 3[39m
 [31m❯[39m src/services/AuthenticationService.integration.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [32m✓[39m src/hooks/useAI.test.ts [2m([22m[2m15 tests[22m[2m)[22m[90m 17[2mms[22m[39m
 [31m❯[39m src/services/LegalAPIService.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/utils/error-logger.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m tests/e2e/specs/user-journey.e2e.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m src/hooks/useReducedMotion.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [32m✓[39m src/services/AIServiceFactory.test.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 14[2mms[22m[39m
 [31m❯[39m tests/e2e/specs/facts-tracking.e2e.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m tests/e2e/specs/evidence-upload.e2e.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m tests/e2e/specs/case-management.e2e.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m tests/e2e/specs/ai-chat.e2e.test.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m tests/e2e/specs/test-1.spec.ts [2m([22m[2m0 test[22m[2m)[22m
 [31m❯[39m tests/e2e/specs/test-2.spec.ts [2m([22m[2m0 test[22m[2m)[22m

[31m⎯⎯⎯⎯⎯⎯[1m[7m Failed Suites 35 [27m[22m⎯⎯⎯⎯⎯⎯[39m

[31m[1m[7m FAIL [27m[22m[39m src/components/ErrorBoundary.test.tsx[2m [ src/components/ErrorBoundary.test.tsx ][22m
[31m[1m[7m FAIL [27m[22m[39m src/components/PostItNote.test.tsx[2m [ src/components/PostItNote.test.tsx ][22m
[31m[1m[7m FAIL [27m[22m[39m src/hooks/useReducedMotion.test.ts[2m [ src/hooks/useReducedMotion.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/cases/components/CaseDetailView.test.tsx[2m [ src/features/cases/components/CaseDetailView.test.tsx ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/cases/components/CasesView.test.tsx[2m [ src/features/cases/components/CasesView.test.tsx ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/chat/components/ChatInput.test.tsx[2m [ src/features/chat/components/ChatInput.test.tsx ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/chat/components/MessageBubble.test.tsx[2m [ src/features/chat/components/MessageBubble.test.tsx ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/dashboard/components/DashboardView.test.tsx[2m [ src/features/dashboard/components/DashboardView.test.tsx ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/documents/components/DocumentsView.test.tsx[2m [ src/features/documents/components/DocumentsView.test.tsx ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/facts/components/UserFactsPanel.test.tsx[2m [ src/features/facts/components/UserFactsPanel.test.tsx ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/facts/hooks/useCaseFacts.test.ts[2m [ src/features/facts/hooks/useCaseFacts.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/facts/hooks/useUserFacts.test.ts[2m [ src/features/facts/hooks/useUserFacts.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/legal/hooks/useLegalIssues.test.ts[2m [ src/features/legal/hooks/useLegalIssues.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/notes/hooks/useNotes.test.ts[2m [ src/features/notes/hooks/useNotes.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/timeline/hooks/useTimeline.test.ts[2m [ src/features/timeline/hooks/useTimeline.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/settings/components/SettingsView.test.tsx[2m [ src/features/settings/components/SettingsView.test.tsx ][22m
[31m[1mError[22m: Failed to load url @testing-library/react (resolved id: @testing-library/react) in F:/Justice Companion take 2/src/features/facts/hooks/useCaseFacts.test.ts. Does the file exist?[39m
[90m [2m❯[22m loadAndTransform ../Justice%20Companion%20take%202/node_modules/.pnpm/vite@5.4.20_@types+node@22.18.10/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:[2m51968:17[22m[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/services/AuthenticationService.integration.test.ts[2m [ src/services/AuthenticationService.integration.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m src/services/AuthenticationService.test.ts[2m [ src/services/AuthenticationService.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m src/services/SessionPersistenceService.test.ts[2m [ src/services/SessionPersistenceService.test.ts ][22m
[31m[1mError[22m: Failed to load url uuid (resolved id: uuid) in F:/Justice Companion take 2/src/services/AuthenticationService.ts. Does the file exist?[39m
[90m [2m❯[22m loadAndTransform ../Justice%20Companion%20take%202/node_modules/.pnpm/vite@5.4.20_@types+node@22.18.10/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:[2m51968:17[22m[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/services/LegalAPIService.test.ts[2m [ src/services/LegalAPIService.test.ts ][22m
[31m[1mError[22m: Failed to load url fast-xml-parser (resolved id: fast-xml-parser) in F:/Justice Companion take 2/src/services/LegalAPIService.ts. Does the file exist?[39m
[90m [2m❯[22m loadAndTransform ../Justice%20Companion%20take%202/node_modules/.pnpm/vite@5.4.20_@types+node@22.18.10/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:[2m51968:17[22m[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/services/StartupMetrics.test.ts[2m [ src/services/StartupMetrics.test.ts ][22m
[31m[1mReferenceError[22m: afterEach is not defined[39m
[36m [2m❯[22m src/services/StartupMetrics.test.ts:[2m13:3[22m[39m
    [90m 11| [39m  })[33m;[39m
    [90m 12| [39m
    [90m 13| [39m  [34mafterEach[39m(() [33m=>[39m {
    [90m   | [39m  [31m^[39m
    [90m 14| [39m    consoleSpy[33m.[39m[34mmockRestore[39m()[33m;[39m
    [90m 15| [39m  })[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/tests/authorization-security.test.ts[2m [ src/tests/authorization-security.test.ts ][22m
[31m[1mError[22m: Failed to load url ../../electron/authorization-wrapper (resolved id: ../../electron/authorization-wrapper) in F:/Justice Companion take 2/src/tests/authorization-security.test.ts. Does the file exist?[39m
[90m [2m❯[22m loadAndTransform ../Justice%20Companion%20take%202/node_modules/.pnpm/vite@5.4.20_@types+node@22.18.10/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:[2m51968:17[22m[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/utils/error-logger.test.ts[2m [ src/utils/error-logger.test.ts ][22m
[31m[1mReferenceError[22m: describe is not defined[39m
[36m [2m❯[22m src/utils/error-logger.test.ts:[2m7:1[22m[39m
    [90m  5| [39m[35mimport[39m path [35mfrom[39m [32m'path'[39m[33m;[39m
    [90m  6| [39m
    [90m  7| [39m[34mdescribe[39m([32m'ErrorLogger'[39m[33m,[39m () [33m=>[39m {
    [90m   | [39m[31m^[39m
    [90m  8| [39m  [35mconst[39m testLogDir [33m=[39m [32m'logs-test'[39m[33m;[39m
    [90m  9| [39m  [35mconst[39m testLogFile [33m=[39m [32m'test-errors.log'[39m[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/e2e/specs/ai-chat.e2e.test.ts[2m [ tests/e2e/specs/ai-chat.e2e.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m tests/e2e/specs/case-management.e2e.test.ts[2m [ tests/e2e/specs/case-management.e2e.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m tests/e2e/specs/evidence-upload.e2e.test.ts[2m [ tests/e2e/specs/evidence-upload.e2e.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m tests/e2e/specs/facts-tracking.e2e.test.ts[2m [ tests/e2e/specs/facts-tracking.e2e.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m tests/e2e/specs/remember-me.e2e.test.ts[2m [ tests/e2e/specs/remember-me.e2e.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m tests/e2e/specs/user-journey.e2e.test.ts[2m [ tests/e2e/specs/user-journey.e2e.test.ts ][22m
[31m[1mError[22m: Failed to load url playwright (resolved id: playwright) in F:/Justice Companion take 2/tests/e2e/setup/electron-setup.ts. Does the file exist?[39m
[90m [2m❯[22m loadAndTransform ../Justice%20Companion%20take%202/node_modules/.pnpm/vite@5.4.20_@types+node@22.18.10/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:[2m51968:17[22m[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/e2e/specs/authentication.e2e.test.ts[2m [ tests/e2e/specs/authentication.e2e.test.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m tests/e2e/specs/authorization.e2e.test.ts[2m [ tests/e2e/specs/authorization.e2e.test.ts ][22m
[31m[1mError[22m: Failed to load url playwright (resolved id: playwright) in F:/Justice Companion take 2/tests/e2e/setup/electron-setup.ts. Does the file exist?[39m
[90m [2m❯[22m loadAndTransform ../Justice%20Companion%20take%202/node_modules/.pnpm/vite@5.4.20_@types+node@22.18.10/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:[2m51968:17[22m[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/e2e/specs/test-1.spec.ts[2m [ tests/e2e/specs/test-1.spec.ts ][22m
[31m[1mError[22m: Playwright Test did not expect test() to be called here.
Most common reasons include:
- You are calling test() in a configuration file.
- You are calling test() in a file that is imported by the configuration file.
- You have two different versions of @playwright/test. This usually happens
  when one of the dependencies in your package.json depends on @playwright/test.[39m
[90m [2m❯[22m TestTypeImpl._currentSuite node_modules/.pnpm/playwright@1.56.0/node_modules/playwright/lib/common/testType.js:[2m74:13[22m[39m
[90m [2m❯[22m TestTypeImpl._createTest node_modules/.pnpm/playwright@1.56.0/node_modules/playwright/lib/common/testType.js:[2m87:24[22m[39m
[90m [2m❯[22m Module.<anonymous> node_modules/.pnpm/playwright@1.56.0/node_modules/playwright/lib/transform/transform.js:[2m275:12[22m[39m
[36m [2m❯[22m tests/e2e/specs/test-1.spec.ts:[2m3:1[22m[39m
    [90m  1| [39m[35mimport[39m { test[33m,[39m expect } [35mfrom[39m [32m'@playwright/test'[39m[33m;[39m
    [90m  2| [39m
    [90m  3| [39m[34mtest[39m([32m'test'[39m[33m,[39m [35masync[39m ({ page }) [33m=>[39m {
    [90m   | [39m[31m^[39m
    [90m  4| [39m  [90m// Recording...[39m
    [90m  5| [39m})[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m tests/e2e/specs/test-2.spec.ts[2m [ tests/e2e/specs/test-2.spec.ts ][22m
[31m[1mError[22m: Playwright Test did not expect test() to be called here.
Most common reasons include:
- You are calling test() in a configuration file.
- You are calling test() in a file that is imported by the configuration file.
- You have two different versions of @playwright/test. This usually happens
  when one of the dependencies in your package.json depends on @playwright/test.[39m
[90m [2m❯[22m TestTypeImpl._currentSuite node_modules/.pnpm/playwright@1.56.0/node_modules/playwright/lib/common/testType.js:[2m74:13[22m[39m
[90m [2m❯[22m TestTypeImpl._createTest node_modules/.pnpm/playwright@1.56.0/node_modules/playwright/lib/common/testType.js:[2m87:24[22m[39m
[90m [2m❯[22m Module.<anonymous> node_modules/.pnpm/playwright@1.56.0/node_modules/playwright/lib/transform/transform.js:[2m275:12[22m[39m
[36m [2m❯[22m tests/e2e/specs/test-2.spec.ts:[2m3:1[22m[39m
    [90m  1| [39m[35mimport[39m { test[33m,[39m expect } [35mfrom[39m [32m'@playwright/test'[39m[33m;[39m
    [90m  2| [39m
    [90m  3| [39m[34mtest[39m([32m'test'[39m[33m,[39m [35masync[39m ({ page }) [33m=>[39m {
    [90m   | [39m[31m^[39m
    [90m  4| [39m  [90m// Recording...[39m
    [90m  5| [39m})[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/features/facts/components/CaseFactsPanel.test.tsx[2m [ src/features/facts/components/CaseFactsPanel.test.tsx ][22m
[31m[1m[7m FAIL [27m[22m[39m src/features/notes/components/NotesPanel.test.tsx[2m [ src/features/notes/components/NotesPanel.test.tsx ][22m
[31m[1mError[22m: Failed to load url @testing-library/react (resolved id: @testing-library/react) in F:/Justice Companion take 2/src/features/facts/hooks/useCaseFacts.test.ts. Does the file exist?[39m
[90m [2m❯[22m loadAndTransform ../Justice%20Companion%20take%202/node_modules/.pnpm/vite@5.4.20_@types+node@22.18.10/node_modules/vite/dist/node/chunks/dep-D_zLpgQd.js:[2m51968:17[22m[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/69]⎯[22m[39m

[31m⎯⎯⎯⎯⎯⎯[1m[7m Failed Tests 34 [27m[22m⎯⎯⎯⎯⎯⎯⎯[39m

[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mError Handling[2m > [22mdoes not throw on logging failure
[31m[1mReferenceError[22m: vi is not defined[39m
[36m [2m❯[22m src/services/AuditLogger.test.ts:[2m606:31[22m[39m
    [90m604| [39m
    [90m605| [39m      [90m// Suppress console.error to avoid polluting test output[39m
    [90m606| [39m      [35mconst[39m consoleErrorSpy [33m=[39m vi[33m.[39m[34mspyOn[39m(console[33m,[39m [32m'error'[39m)[33m.[39m[34mmockImplement[39m…
    [90m   | [39m                              [31m^[39m
    [90m607| [39m
    [90m608| [39m      [90m// Should not throw[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mEdge Cases[2m > [22mhandles null/undefined optional fields
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mEdge Cases[2m > [22mserializes complex details objects
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mEdge Cases[2m > [22mhandles details with null value
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mEdge Cases[2m > [22mhandles empty details object
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mEdge Cases[2m > [22mhandles very long detail strings
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mEdge Cases[2m > [22mhandles special characters in fields
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mEdge Cases[2m > [22mhandles Unicode characters in details
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mAction Types[2m > [22msupports create action
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mAction Types[2m > [22msupports read action
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mAction Types[2m > [22msupports update action
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mAction Types[2m > [22msupports delete action
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mAction Types[2m > [22msupports export action
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mAction Types[2m > [22msupports decrypt action
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mSuccess and Error Tracking[2m > [22mlogs successful operations with success=true
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mSuccess and Error Tracking[2m > [22mlogs failed operations with success=false and error message
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mSuccess and Error Tracking[2m > [22mfilters successful operations only
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mSuccess and Error Tracking[2m > [22mfilters failed operations only
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mImmutability[2m > [22mcreates new log entries without modifying existing ones
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mLarge Chain Verification[2m > [22mverifies chain with 100 entries
[31m[1m[7m FAIL [27m[22m[39m src/services/AuditLogger.test.ts[2m > [22mAuditLogger[2m > [22mLarge Chain Verification[2m > [22mdetects tampering in middle of large chain
[31m[1mTypeError[22m: The database connection is not open[39m
[90m [2m❯[22m Database.exec node_modules/.pnpm/better-sqlite3@11.10.0/node_modules/better-sqlite3/lib/methods/wrappers.js:[2m9:14[22m[39m
[36m [2m❯[22m src/services/AuditLogger.test.ts:[2m46:8[22m[39m
    [90m 44| [39m  [34mbeforeEach[39m(() [33m=>[39m {
    [90m 45| [39m    [90m// Drop and recreate table to ensure clean state[39m
    [90m 46| [39m    db[33m.[39m[34mexec[39m([32m'DROP TABLE IF EXISTS audit_logs'[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m 47| [39m    db[33m.[39m[34mexec[39m([32m`
    [90m 48| [39m      CREATE TABLE audit_logs (

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/services/ChatConversationService.test.ts[2m > [22mChatConversationService[2m > [22mloadConversation()[2m > [22mshould log PII access when loading messages
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2m❯[22m src/services/ChatConversationService.test.ts:[2m296:25[22m[39m
    [90m294| [39m      )[33m;[39m
    [90m295| [39m
    [90m296| [39m      [34mexpect[39m(accessLog)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m297| [39m      [34mexpect[39m(accessLog[33m.[39msuccess)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m298| [39m      [34mexpect[39m([33mJSON[39m[33m.[39m[34mparse[39m(accessLog[33m.[39mdetails)[33m.[39mencrypted)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/services/ChatConversationService.test.ts[2m > [22mChatConversationService[2m > [22maddMessage()[2m > [22mshould log message creation event
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2m❯[22m src/services/ChatConversationService.test.ts:[2m374:25[22m[39m
    [90m372| [39m      [35mconst[39m createLog [33m=[39m logs[33m.[39m[34mfind[39m((log[33m:[39m any) [33m=>[39m log[33m.[39mevent_type [33m===[39m [32m'me[39m…
    [90m373| [39m
    [90m374| [39m      [34mexpect[39m(createLog)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m375| [39m      [34mexpect[39m(createLog[33m.[39msuccess)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m376| [39m      [34mexpect[39m([33mJSON[39m[33m.[39m[34mparse[39m(createLog[33m.[39mdetails)[33m.[39mrole)[33m.[39m[34mtoBe[39m([32m'user'[39m)[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/services/UserProfileService.test.ts[2m > [22mUserProfileService[2m > [22mgetProfile()[2m > [22mshould log PII access when reading encrypted fields
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2m❯[22m src/services/UserProfileService.test.ts:[2m86:25[22m[39m
    [90m 84| [39m      [35mconst[39m accessLog [33m=[39m logs[33m.[39m[34mfind[39m((log[33m:[39m any) [33m=>[39m log[33m.[39mevent_type [33m===[39m [32m'pr[39m…
    [90m 85| [39m
    [90m 86| [39m      [34mexpect[39m(accessLog)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 87| [39m      [34mexpect[39m(accessLog[33m.[39msuccess)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m 88| [39m      [34mexpect[39m([33mJSON[39m[33m.[39m[34mparse[39m(accessLog[33m.[39mdetails)[33m.[39mencrypted)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/services/UserProfileService.test.ts[2m > [22mUserProfileService[2m > [22mupdateProfile()[2m > [22mshould log profile update event
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2m❯[22m src/services/UserProfileService.test.ts:[2m193:25[22m[39m
    [90m191| [39m      [35mconst[39m updateLog [33m=[39m logs[33m.[39m[34mfind[39m((log[33m:[39m any) [33m=>[39m log[33m.[39mevent_type [33m===[39m [32m'pr[39m…
    [90m192| [39m
    [90m193| [39m      [34mexpect[39m(updateLog)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m194| [39m      [34mexpect[39m(updateLog[33m.[39msuccess)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m195| [39m      [35mconst[39m details [33m=[39m [33mJSON[39m[33m.[39m[34mparse[39m(updateLog[33m.[39mdetails)[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/services/UserProfileService.test.ts[2m > [22mUserProfileService[2m > [22mGDPR Compliance[2m > [22mshould maintain audit trail of profile changes
[31m[1mAssertionError[22m: expected 0 to be greater than or equal to 3[39m
[36m [2m❯[22m src/services/UserProfileService.test.ts:[2m371:33[22m[39m
    [90m369| [39m      [35mconst[39m updateLogs [33m=[39m logs[33m.[39m[34mfilter[39m((log[33m:[39m any) [33m=>[39m log[33m.[39mevent_type [33m===[39m …
    [90m370| [39m
    [90m371| [39m      [34mexpect[39m(updateLogs[33m.[39mlength)[33m.[39m[34mtoBeGreaterThanOrEqual[39m([34m3[39m)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m372| [39m    })[33m;[39m
    [90m373| [39m  })[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/utils/migrate-to-secure-storage.test.ts[2m > [22mmigrate-to-secure-storage[2m > [22mmigrateToSecureStorage[2m > [22mshould migrate API keys from localStorage to secure storage
[31m[1mAssertionError[22m: expected +0 to be 3 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 3[39m
[31m+ 0[39m

[36m [2m❯[22m src/utils/migrate-to-secure-storage.test.ts:[2m102:35[22m[39m
    [90m100| [39m      [90m// Verify results[39m
    [90m101| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m102| [39m      [34mexpect[39m(result[33m.[39mmigratedKeys)[33m.[39m[34mtoBe[39m([34m3[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m103| [39m      [34mexpect[39m(result[33m.[39mfailedKeys)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m
    [90m104| [39m      [34mexpect[39m(result[33m.[39mtotalKeys)[33m.[39m[34mtoBe[39m([34m3[39m)[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[19/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/utils/migrate-to-secure-storage.test.ts[2m > [22mmigrate-to-secure-storage[2m > [22mmigrateToSecureStorage[2m > [22mshould not migrate keys that already exist in secure storage
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'openai_api_key' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2m❯[22m src/utils/migrate-to-secure-storage.test.ts:[2m142:43[22m[39m
    [90m140| [39m
    [90m141| [39m      [90m// Verify key was still removed from localStorage (cleanup)[39m
    [90m142| [39m      [34mexpect[39m(mockLocalStorage[33m.[39mremoveItem)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m'openai[39m…
    [90m   | [39m                                          [31m^[39m
    [90m143| [39m    })[33m;[39m
    [90m144| [39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[20/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/utils/migrate-to-secure-storage.test.ts[2m > [22mmigrate-to-secure-storage[2m > [22mmigrateToSecureStorage[2m > [22mshould handle errors gracefully
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

[36m [2m❯[22m src/utils/migrate-to-secure-storage.test.ts:[2m177:30[22m[39m
    [90m175| [39m
    [90m176| [39m      [90m// Verify results[39m
    [90m177| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m178| [39m      [34mexpect[39m(result[33m.[39mmigratedKeys)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m
    [90m179| [39m      [34mexpect[39m(result[33m.[39mfailedKeys)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[21/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/utils/migrate-to-secure-storage.test.ts[2m > [22mmigrate-to-secure-storage[2m > [22mmigrateToSecureStorage[2m > [22mshould warn when encryption is not available
[31m[1mAssertionError[22m: expected "warn" to be called with arguments: [ StringContaining{…} ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2m❯[22m src/utils/migrate-to-secure-storage.test.ts:[2m200:26[22m[39m
    [90m198| [39m
    [90m199| [39m      [90m// Verify warning was logged[39m
    [90m200| [39m      [34mexpect[39m(consoleSpy)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                         [31m^[39m
    [90m201| [39m        expect[33m.[39m[34mstringContaining[39m([32m'OS-native encryption not available'[39m)
    [90m202| [39m      )[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[22/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/utils/migrate-to-secure-storage.test.ts[2m > [22mmigrate-to-secure-storage[2m > [22mmigrateToSecureStorage[2m > [22mshould be idempotent (safe to run multiple times)
[31m[1mAssertionError[22m: expected +0 to be 1 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2m❯[22m src/utils/migrate-to-secure-storage.test.ts:[2m228:36[22m[39m
    [90m226| [39m
    [90m227| [39m      [35mconst[39m result1 [33m=[39m [35mawait[39m [34mmigrateToSecureStorage[39m()[33m;[39m
    [90m228| [39m      [34mexpect[39m(result1[33m.[39mmigratedKeys)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m229| [39m
    [90m230| [39m      [90m// Second run: no keys to migrate[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[23/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/utils/migrate-to-secure-storage.test.ts[2m > [22mmigrate-to-secure-storage[2m > [22misMigrationNeeded[2m > [22mshould return true when keys exist in localStorage but not in secure storage
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m❯[22m src/utils/migrate-to-secure-storage.test.ts:[2m251:22[22m[39m
    [90m249| [39m
    [90m250| [39m      [35mconst[39m needed [33m=[39m [35mawait[39m [34misMigrationNeeded[39m()[33m;[39m
    [90m251| [39m      [34mexpect[39m(needed)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m252| [39m    })[33m;[39m
    [90m253| [39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[24/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/utils/migrate-to-secure-storage.test.ts[2m > [22mmigrate-to-secure-storage[2m > [22mcleanupLocalStorage[2m > [22mshould remove all migration keys from localStorage
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'openai_api_key' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2m❯[22m src/utils/migrate-to-secure-storage.test.ts:[2m282:43[22m[39m
    [90m280| [39m
    [90m281| [39m      [90m// Verify all keys were attempted to be removed[39m
    [90m282| [39m      [34mexpect[39m(mockLocalStorage[33m.[39mremoveItem)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m'openai[39m…
    [90m   | [39m                                          [31m^[39m
    [90m283| [39m      [34mexpect[39m(mockLocalStorage[33m.[39mremoveItem)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m'openai[39m…
    [90m284| [39m      [34mexpect[39m(mockLocalStorage[33m.[39mremoveItem)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m'openai[39m…

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[25/69]⎯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/utils/migrate-to-secure-storage.test.ts[2m > [22mmigrate-to-secure-storage[2m > [22mcleanupLocalStorage[2m > [22mshould handle errors gracefully
[31m[1mAssertionError[22m: expected "error" to be called at least once[39m
[36m [2m❯[22m src/utils/migrate-to-secure-storage.test.ts:[2m300:26[22m[39m
    [90m298| [39m
    [90m299| [39m      [90m// Verify errors were logged[39m
    [90m300| [39m      [34mexpect[39m(consoleSpy)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m301| [39m
    [90m302| [39m      consoleSpy[33m.[39m[34mmockRestore[39m()[33m;[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[26/69]⎯[22m[39m

[2m Test Files [22m [1m[31m39 failed[39m[22m[2m | [22m[1m[32m23 passed[39m[22m[90m (62)[39m
[2m      Tests [22m [1m[31m34 failed[39m[22m[2m | [22m[1m[32m747 passed[39m[22m[90m (781)[39m
[2m   Start at [22m 18:28:56
[2m   Duration [22m 6.31s[2m (transform 8.88s, setup 0ms, collect 9.02s, tests 5.27s, environment 37ms, prepare 16.70s)[22m

 ELIFECYCLE  Test failed. See above for more details.
