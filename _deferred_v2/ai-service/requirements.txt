# Justice Companion AI Service - Runtime Dependencies
# Python 3.11+ required
# Install with: pip install -r requirements.txt

# ========================================================================================
# WEB FRAMEWORK
# ========================================================================================

fastapi>=0.120.0,<0.121.0               # Modern async web framework (supports starlette 0.49+)
starlette>=0.49.1,<0.51.0               # Patched ASGI toolkit (fixes CVE-2025-62727 ReDoS)
uvicorn[standard]>=0.30.0,<0.35.0       # ASGI server implementation

# ========================================================================================
# AI & MACHINE LEARNING - HUGGING FACE (PRIMARY PROVIDER)
# ========================================================================================

accelerate>=0.26.0,<1.0.0               # Distributed training and inference acceleration
huggingface_hub>=0.20.0,<1.0.0          # Model and dataset sharing platform
safetensors>=0.4.2,<1.0.0               # Safe serialization of tensors (replacement for pickle)
sentencepiece>=0.1.99,<1.0.0            # Subword tokenization algorithm
tokenizers>=0.15.0,<1.0.0               # Fast, customizable tokenization library
torch>=2.6.0,<2.7.0                     # PyTorch (fixes CVE-2025-32434 RCE vulnerability)
transformers>=4.53.0,<5.0.0             # State-of-the-art NLP models (fixes multiple ReDoS CVEs)

# ========================================================================================
# AI & MACHINE LEARNING - OPENAI (FALLBACK PROVIDER)
# ========================================================================================

openai>=1.0.0,<2.0.0                    # OpenAI API client (minor updates allowed)

# ========================================================================================
# DATA VALIDATION & SERIALIZATION
# ========================================================================================

pydantic>=2.6.0,<3.0.0                   # Data validation using Python type hints
pydantic-settings>=2.0.0,<3.0.0         # Settings management for Pydantic
python-multipart>=0.0.18,<1.0.0         # Streaming multipart parsing (fixes CVE-2024-53981 DoS)

# ========================================================================================
# HTTP CLIENTS & NETWORKING
# ========================================================================================

httpx>=0.26.0,<1.0.0                    # Modern async HTTP client

# ========================================================================================
# IMAGE PROCESSING & OCR
# ========================================================================================

Pillow>=11.0.1,<12.0.0                  # PIL fork - image processing (security patches applied)
pillow-heif>=0.15.0,<1.0.0              # HEIF/HEIC image support for Pillow
pytesseract>=0.3.10,<1.0.0              # Python wrapper for Tesseract OCR

# ========================================================================================
# DOCUMENT PROCESSING
# ========================================================================================

pdf2image>=1.16.3,<2.0.0                # PDF to image conversion
# Note: pdf2image requires poppler-utils. Install with:
#   Debian/Ubuntu: sudo apt-get install poppler-utils
#   macOS: brew install poppler
#   Windows: Download from https://blog.alivate.com.au/poppler-windows/

# ========================================================================================
# SECURITY NOTES
# ========================================================================================
#
# Core Security Updates (November 2025):
# - starlette>=0.49.1: Fixes CVE-2025-62727 (ReDoS in FileResponse Range header)
# - torch>=2.6.0: Fixes CVE-2025-32434 (Critical RCE in torch.load with weights_only=True)
# - transformers>=4.53.0: Fixes multiple ReDoS CVEs (CVE-2025-6638, CVE-2025-6051, CVE-2025-6921)
# - python-multipart>=0.0.18: Fixes CVE-2024-53981 (DoS via excessive logging)
# - Pillow>=11.0.1: Addresses multiple image processing vulnerabilities
# - pydantic>=2.6.0: Enhanced validation security and performance
#
# Note: urllib3 open redirect (CVE-2025-10390193/4) has no available fix yet - low severity
#
# Version Strategy:
# - Upper bounds prevent breaking changes from major version updates
# - Lower bounds ensure critical security patches are included
# - Development dependencies are in requirements-dev.txt (NOT HERE)
# ========================================================================================
